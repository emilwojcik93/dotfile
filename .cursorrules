# Windows Development Environment - Coding Standards

## Project Overview

Modern Infrastructure as Code (IaC) development environment for Windows 11 with PowerShell, WSL, Python, and Docker.

**Repository Location**: `${env:USERPROFILE}\dotfile`

## Repository Structure

```
dotfile/
‚îú‚îÄ‚îÄ automation/          # Installation & update scripts
‚îú‚îÄ‚îÄ configs/            # VS Code & tool configurations
‚îú‚îÄ‚îÄ src/                # Source files & templates
‚îú‚îÄ‚îÄ docs/               # Documentation (topic-specific)
‚îú‚îÄ‚îÄ Beast Mode.chatmode.md  # Cursor AI configuration
‚îú‚îÄ‚îÄ .cursorrules        # This file - coding standards
‚îú‚îÄ‚îÄ Install.ps1         # Quick installer
‚îî‚îÄ‚îÄ README.md           # Main documentation
```

---

## PowerShell Coding Standards

### Character Encoding
- **UTF-8/ASCII ONLY** - No emojis or Unicode characters in scripts
- Standard ASCII for maximum compatibility
- UTF-8 encoding without BOM

### Variable Syntax (PowerShell 5.x Compatible)
- Use bracketed syntax for special characters: `${var}:`, `${var}%`, `"${var}.exe"`
- Use `${env:PATH}` when concatenating
- **NEVER** use read-only variables as script variables: `$Error`, `$host`, `$HOME`, `$PWD`, `$PROFILE`, `$PID`, `$LASTEXITCODE`

### PowerShell 5.x Compatibility
- All scripts MUST work on PowerShell 5.1 (Windows 11 default)
- Test on PowerShell 5.x before deployment
- Avoid PowerShell 7+ exclusive features
- Use `-Force` instead of `-Confirm:$false`

### Error Handling
- Use `try/catch/finally` blocks
- Use `Write-Error` for user-facing errors
- Use `throw` for critical failures
- Add `-ErrorAction Stop` when halting is needed
- Never use workarounds - fix the root cause

### Infrastructure as Code Principles
- Repeatable and idempotent automation
- Parameter validation with `[Parameter()]` attributes
- Self-elevation for admin scripts (WinUtil-style)
- Support interactive and silent modes
- Comprehensive logging with timestamps
- Use `-WhatIf` and `-Confirm` where appropriate

### Code Quality
- Production-ready code, not examples
- 4-space indentation
- PascalCase for functions, camelCase for variables
- Meaningful names
- Comment WHY, not WHAT
- Atomic commits with conventional commit messages: `type(scope): description`

### Security
- No hardcoded credentials
- Validate all inputs
- Use `Get-Credential`, `ConvertTo-SecureString`
- Principle of least privilege
- Use `Start-Process -Verb RunAs` for elevation

---

## Self-Elevation Pattern

All admin scripts use WinUtil-style self-elevation:

```powershell
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Host 'Requesting administrator privileges...' -ForegroundColor Yellow
    Start-Process PowerShell -Verb RunAs "-File `"${PSCommandPath}`" $args"
    exit
}
```

---

## Unattended Installation Support

- All scripts support `-Silent` parameter
- Use `winget install --silent --accept-package-agreements --accept-source-agreements`
- No interactive prompts in silent mode
- Log all operations with timestamps

---

## File Naming Conventions

- Scripts: `Verb-Noun.ps1` (PascalCase)
- Functions: `ModuleName.psm1`
- Configs: `lowercase-with-hyphens.json`
- Docs: `UPPERCASE-TITLES.md`

---

## Git & Version Control

- Conventional commits: `type(scope): description`
- Include issue IDs: `feat(install): add Docker [PROJ-123]`
- Test before committing
- Use `.gitignore` for temp files
- Tag releases with semantic versioning

---

## Documentation Requirements

- All functions have comment-based help
- README with setup instructions
- Document system requirements
- Include troubleshooting sections
- Maintain changelog

---

## Error Examples

### ‚ùå Bad
```powershell
$Error = @()                    # Using read-only variable
$path:backup = "C:\Backup"      # Incorrect syntax
Write-Host "‚úÖ Done! üéâ"        # Unicode characters
cd C:\Users\user\dotfile        # Hardcoded path
Copy-Item $source $dest         # No error handling
```

### ‚úÖ Good
```powershell
${CustomErrors} = @()           # Custom variable name
${path}:backup = "C:\Backup"    # Correct bracketed syntax
Write-Host "[SUCCESS] Done!"    # ASCII only
cd ${env:USERPROFILE}\dotfile   # Environment variable
try {
    Copy-Item $source $dest -ErrorAction Stop
    Write-Host "[INFO] File copied"
} catch {
    Write-Error "Failed: ${_}"
    throw
}
```

---

## Development Workflow

### Setup
```powershell
cd ${env:USERPROFILE}\dotfile
.\Install.ps1
```

### Testing
- Test in isolated PowerShell sessions
- Validate on clean Windows 11 systems
- Test both interactive and silent modes
- Check PowerShell 5.1 and 7.x compatibility

### Committing
```powershell
git add .
git commit -m "feat(scope): description"
git push
```

---

## Maintenance Log

### 2025-11-10: Repository Reorganization
- ‚úÖ Streamlined documentation structure
- ‚úÖ Consolidated to essential scripts only
- ‚úÖ Created focused topic-specific docs (COMMANDS, TROUBLESHOOTING, WSL_DOCKER)
- ‚úÖ Updated README with clear structure
- ‚úÖ Removed redundant/deprecated files

### 2025-10-28: Repository Relocation
- ‚úÖ Moved to `${env:USERPROFILE}\dotfile`
- ‚úÖ Maintained full git history
- ‚úÖ Updated all path references

---

## Related Documentation

- [README.md](README.md) - Main project documentation
- [docs/COMMANDS.md](docs/COMMANDS.md) - Frequently used commands
- [docs/TROUBLESHOOTING.md](docs/TROUBLESHOOTING.md) - Common issues
- [docs/WSL_DOCKER.md](docs/WSL_DOCKER.md) - Linux subsystem setup

---

**This project follows Infrastructure as Code principles with PowerShell 5.x compatibility as the primary requirement. All code must be production-ready and thoroughly tested.**
